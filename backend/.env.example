# =============================================================================
# TURBOCAT BACKEND - ENVIRONMENT VARIABLES
# =============================================================================
# Copy this file to .env and fill in your values
# NEVER commit .env to version control!
#
# Legend:
#   [REQUIRED]  - Must be set for the application to start
#   [OPTIONAL]  - Has a default value or is not required
#   [DEV ONLY]  - Only needed for development/testing
#
# For detailed setup instructions, see: docs/environment-setup.md
# =============================================================================


# =============================================================================
# DATABASE (Supabase PostgreSQL) [REQUIRED]
# =============================================================================
# Get these from your Supabase project: Settings > Database > Connection string
# See docs/SUPABASE_SETUP.md for detailed setup instructions.
#
# DATABASE_URL: Use the "Connection pooling" URL (port 6543)
# This URL uses pgBouncer for connection pooling, recommended for serverless/edge
# Format: postgresql://postgres.[PROJECT-REF]:[PASSWORD]@aws-0-[REGION].pooler.supabase.com:6543/postgres?pgbouncer=true
#
# DIRECT_URL: Use the "Direct connection" URL (port 5432)
# Required for migrations, bypasses connection pooler
# Format: postgresql://postgres.[PROJECT-REF]:[PASSWORD]@aws-0-[REGION].pooler.supabase.com:5432/postgres
#
DATABASE_URL="postgresql://postgres.[YOUR-PROJECT-REF]:[YOUR-PASSWORD]@aws-0-[REGION].pooler.supabase.com:6543/postgres?pgbouncer=true"
DIRECT_URL="postgresql://postgres.[YOUR-PROJECT-REF]:[YOUR-PASSWORD]@aws-0-[REGION].pooler.supabase.com:5432/postgres"


# =============================================================================
# TEST DATABASE [DEV ONLY]
# =============================================================================
# IMPORTANT: Use a separate database for tests to avoid data loss!
# Options:
# 1. Separate Supabase project for testing (recommended)
# 2. Local PostgreSQL instance
# 3. Docker PostgreSQL container:
#    docker run -d -p 5433:5432 -e POSTGRES_PASSWORD=test postgres
#
# If not set, tests will use DATABASE_URL (not recommended for production DBs)
#
TEST_DATABASE_URL="postgresql://postgres:test@localhost:5433/turbocat_test"


# =============================================================================
# SUPABASE [REQUIRED]
# =============================================================================
# Get these from your Supabase project: Settings > API
# See docs/SUPABASE_SETUP.md for detailed setup instructions.
#
# SUPABASE_URL: Your project's API URL
# SUPABASE_ANON_KEY: Public key (safe for client-side)
# SUPABASE_SERVICE_ROLE_KEY: Admin key (NEVER expose to clients!)
#
SUPABASE_URL="https://[YOUR-PROJECT-REF].supabase.co"
SUPABASE_ANON_KEY="your-supabase-anon-key"
SUPABASE_SERVICE_ROLE_KEY="your-supabase-service-role-key"


# =============================================================================
# JWT AUTHENTICATION [REQUIRED]
# =============================================================================
# Generate secure secrets using one of these methods:
#
# PowerShell (Windows):
#   [Convert]::ToBase64String([System.Security.Cryptography.RandomNumberGenerator]::GetBytes(64))
#
# Node.js:
#   node -e "console.log(require('crypto').randomBytes(64).toString('hex'))"
#
# OpenSSL (Linux/Mac):
#   openssl rand -hex 64
#
# SECURITY REQUIREMENTS:
# - Use at least 64 bytes (128 hex characters) for each secret
# - Use DIFFERENT secrets for access and refresh tokens
# - NEVER reuse secrets across environments
#
JWT_ACCESS_SECRET="your-64-character-hex-secret-for-access-tokens"
JWT_REFRESH_SECRET="your-64-character-hex-secret-for-refresh-tokens"

# [OPTIONAL] Token expiry times (format: "15m", "1h", "7d")
# Default: 15m for access, 7d for refresh
JWT_ACCESS_EXPIRY="15m"
JWT_REFRESH_EXPIRY="7d"


# =============================================================================
# ENCRYPTION [REQUIRED]
# =============================================================================
# Used for encrypting sensitive data at rest (API keys, credentials, etc.)
# MUST be exactly 32 bytes (64 hex characters)
#
# Generate using:
# - Node.js: node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
# - PowerShell: [Convert]::ToBase64String([System.Security.Cryptography.RandomNumberGenerator]::GetBytes(32))
# - OpenSSL: openssl rand -hex 32
#
# Required for:
# - OAuth provider credentials (encrypted before database storage)
# - Apple Developer API credentials (encrypted before database storage)
# - Expo access tokens (encrypted before database storage)
# - Any other sensitive user-provided credentials
#
ENCRYPTION_KEY="your-64-hex-character-encryption-key-here"


# =============================================================================
# APPLE DEVELOPER API [OPTIONAL - for Publishing Flow]
# =============================================================================
# These are OPTIONAL. Users provide their own Apple credentials via the UI.
# The credentials are encrypted (using ENCRYPTION_KEY) before storage in the database.
#
# Only set these if you want to use shared test credentials during development.
# For production, users will provide their own credentials through the Publishing Flow UI.
#
# How to obtain credentials:
# 1. Go to: https://appstoreconnect.apple.com/access/api
# 2. Create an API key with "Admin" or "App Manager" role
# 3. Download the private key (.p8 file) - you can only download once!
# 4. Copy the Key ID, Issuer ID, and Team ID
#
# APPLE_TEAM_ID: Your Apple Developer Team ID (10-character alphanumeric)
# APPLE_KEY_ID: The Key ID from App Store Connect (10-character alphanumeric)
# APPLE_ISSUER_ID: The Issuer ID from App Store Connect (UUID format)
# APPLE_PRIVATE_KEY: The contents of the .p8 file (keep the -----BEGIN/END----- lines)
#
# APPLE_TEAM_ID="ABC123XYZ"
# APPLE_KEY_ID="KEY123ABC"
# APPLE_ISSUER_ID="12345678-1234-1234-1234-123456789012"
# APPLE_PRIVATE_KEY="-----BEGIN PRIVATE KEY-----\nYourKeyHere\n-----END PRIVATE KEY-----"


# =============================================================================
# EXPO BUILD SERVICES [OPTIONAL - for Publishing Flow]
# =============================================================================
# This is OPTIONAL. Users provide their own Expo access token via the UI.
# The token is encrypted (using ENCRYPTION_KEY) before storage in the database.
#
# Only set this if you want to use a shared Expo account during development.
# For production, users will provide their own token through the Publishing Flow UI.
#
# How to obtain an Expo access token:
# 1. Log in to https://expo.dev
# 2. Go to: https://expo.dev/accounts/[your-account]/settings/access-tokens
# 3. Click "Create Token"
# 4. Give it a descriptive name (e.g., "Turbocat Development")
# 5. Copy the token (you can only see it once!)
#
# EXPO_ACCESS_TOKEN: Personal or Robot access token from Expo
# Scopes required: Read/Write access to projects and builds
#
# EXPO_ACCESS_TOKEN="your-expo-access-token-here"


# =============================================================================
# REDIS [OPTIONAL for development]
# =============================================================================
# Used for sessions, caching, and job queues.
# If not configured, application will run with in-memory fallback (development only).
#
# Options for development:
# 1. Local Redis: redis://localhost:6379
# 2. Docker: docker run -d -p 6379:6379 redis:alpine
#
# Options for production (recommended):
# 1. Upstash Redis (serverless, pay-per-request): https://upstash.com
#    Format: rediss://default:[PASSWORD]@[ENDPOINT]:6379
# 2. Railway Redis: https://railway.app
#    Format: redis://default:[PASSWORD]@[HOST]:6379
#
# Note: Use rediss:// (with double 's') for TLS connections in production
#
REDIS_URL="redis://localhost:6379"


# =============================================================================
# APPLICATION [OPTIONAL - has defaults]
# =============================================================================
# NODE_ENV: "development" | "production" | "test"
# Default: development
NODE_ENV="development"

# Server port (Default: 3001)
PORT=3001

# Server host (Default: localhost for dev, 0.0.0.0 for production)
HOST="localhost"

# API version prefix (Default: v1)
# Affects API routes: /api/v1/...
API_VERSION="v1"


# =============================================================================
# CORS CONFIGURATION [REQUIRED in production]
# =============================================================================
# FRONTEND_URL: Primary frontend URL for CORS
# This MUST match your frontend's URL exactly (including protocol, no trailing slash)
#
FRONTEND_URL="http://localhost:3000"

# [OPTIONAL] Additional CORS origins (comma-separated)
# Useful for multiple frontend domains (www, staging, etc.)
# Example: "https://www.example.com,https://staging.example.com"
#
# ADDITIONAL_CORS_ORIGINS="https://www.your-domain.com"


# =============================================================================
# LOGGING [OPTIONAL - has defaults]
# =============================================================================
# Log levels (in order of verbosity): error, warn, info, http, verbose, debug, silly
# Default: "debug" in development, "info" in production
#
LOG_LEVEL="debug"

# [OPTIONAL] Write logs to file (in addition to console)
# Default: false in development, true in production
# LOG_TO_FILE="false"


# =============================================================================
# SESSION CONFIGURATION [OPTIONAL]
# =============================================================================
# Session TTL in seconds (Default: 86400 = 24 hours)
# SESSION_TTL_SECONDS=86400


# =============================================================================
# RATE LIMITING [OPTIONAL - has defaults]
# =============================================================================
# Maximum requests per IP per time window
# Default: 100
RATE_LIMIT_MAX=100

# Time window in minutes
# Default: 15
RATE_LIMIT_WINDOW_MINUTES=15


# =============================================================================
# OAUTH AUTHENTICATION [OPTIONAL]
# =============================================================================
# Feature flag to enable/disable OAuth login
# Set to "true" to enable OAuth authentication
# Default: false (OAuth disabled)
# Security: Allows instant disable of OAuth in case of security issues
ENABLE_OAUTH_LOGIN="false"

# Google OAuth 2.0 credentials
# Get from: https://console.cloud.google.com/apis/credentials
# Required scopes: openid, profile, email
# GOOGLE_CLIENT_ID="your-google-client-id.apps.googleusercontent.com"
# GOOGLE_CLIENT_SECRET="your-google-client-secret"

# GitHub OAuth 2.0 credentials
# Get from: https://github.com/settings/developers
# Required scopes: read:user, user:email
# GITHUB_CLIENT_ID="your-github-client-id"
# GITHUB_CLIENT_SECRET="your-github-client-secret"

# Microsoft OAuth 2.0 (Azure AD) credentials
# Get from: https://portal.azure.com/#blade/Microsoft_AAD_RegisteredApps
# Required scopes: openid, profile, email
# MICROSOFT_CLIENT_ID="your-microsoft-client-id"
# MICROSOFT_CLIENT_SECRET="your-microsoft-client-secret"

# Backend URL for OAuth callbacks
# Must match the redirect URI configured in OAuth providers
# Default: http://localhost:3001
BACKEND_URL="http://localhost:3001"


# =============================================================================
# CLAUDE AGENT SDK [REQUIRED for AI features]
# =============================================================================
# The Anthropic API key is required for all Claude Agent SDK features.
# Get from: https://console.anthropic.com/
#
# IMPORTANT: This is the single AI provider for Turbocat.
# All AI agent operations use the Claude Agent SDK exclusively.
#
ANTHROPIC_API_KEY="sk-ant-your-api-key-here"

# [OPTIONAL] Default model for agent queries
# Options: claude-sonnet-4-5-20250929, claude-opus-4-20250514, claude-3-5-sonnet-20241022
# Default: claude-sonnet-4-5-20250929
AGENT_DEFAULT_MODEL="claude-sonnet-4-5-20250929"

# [OPTIONAL] Skills directory path (absolute or relative to backend/)
# Default: Automatically resolved to .claude/skills inside backend/
# Only set if you want to override the default location
# SKILLS_DIRECTORY=".claude/skills"


# =============================================================================
# DEBUGGING [DEV ONLY]
# =============================================================================
# Enable verbose test output
# DEBUG_TESTS="true"
